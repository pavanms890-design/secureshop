{% extends 'base.html' %}
{% block title %}{{ product.name }} — SecureShop{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/products.css') }}">
{% endblock %}

{% block content %}
<div style="max-width:1200px; margin:0 auto; padding:2rem 1.5rem;">

    <!-- Breadcrumb -->
    <div style="font-size:0.85rem; color:#999; margin-bottom:1.5rem;">
        <a href="{{ url_for('home') }}" style="color:#6c63ff;">Home</a> /
        <a href="{{ url_for('products') }}" style="color:#6c63ff;">Products</a> /
        <a href="{{ url_for('products') }}?category={{ product.category }}"
           style="color:#6c63ff;">{{ product.category }}</a> /
        <span>{{ product.name }}</span>
    </div>

    <!-- Product Detail Grid -->
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:3rem; margin-bottom:3rem;">

        <!-- LEFT: Product Image -->
        <div>
            <div style="border-radius:20px; overflow:hidden; background:#f8f8f8;
                        border:1.5px solid #eee; aspect-ratio:1;">
                <img src="{{ product.image_url }}" alt="{{ product.name }}"
                     onerror="this.src='https://via.placeholder.com/500x500?text=No+Image'"
                     style="width:100%; height:100%; object-fit:cover;">
            </div>
        </div>

        <!-- RIGHT: Product Info -->
        <div style="display:flex; flex-direction:column; gap:1rem;">

            <span style="background:#f0eeff; color:#6c63ff; padding:0.3rem 0.9rem;
                         border-radius:50px; font-size:0.8rem; font-weight:600;
                         width:fit-content;">
                {{ product.category }}
            </span>

            <h1 style="font-size:1.8rem; font-weight:800; color:#1a1a2e; line-height:1.3;">
                {{ product.name }}
            </h1>

            <!-- Rating -->
            <div style="display:flex; align-items:center; gap:0.5rem;">
                {% for i in range(5) %}
                    <i class="fa{% if i < product.rating|int %}s{% else %}r{% endif %} fa-star"
                       style="color:{% if i < product.rating|int %}#f39c12{% else %}#ddd{% endif %};font-size:1rem;"></i>
                {% endfor %}
                <span style="font-size:0.9rem; color:#666;">{{ product.rating }} out of 5</span>
            </div>

            <!-- Price -->
            <div style="display:flex; align-items:center; gap:1rem;">
                <span style="font-size:2.2rem; font-weight:800; color:#1a1a2e;">
                    ₹{{ "%.0f"|format(product.price) }}
                </span>
                {% if product.original_price and product.original_price > product.price %}
                <span style="font-size:1.1rem; color:#999; text-decoration:line-through;">
                    ₹{{ "%.0f"|format(product.original_price) }}
                </span>
                <span style="background:#e8f5e9; color:#2ecc71; padding:0.3rem 0.75rem;
                             border-radius:50px; font-size:0.85rem; font-weight:700;">
                    {{ ((1 - product.price/product.original_price)*100)|int }}% OFF
                </span>
                {% endif %}
            </div>

            <!-- Stock Status -->
            <div>
                {% if product.stock == 0 %}
                    <span style="color:#e74c3c; font-weight:600;">❌ Out of Stock</span>
                {% elif product.stock <= 2 %}
                    <span style="color:#e74c3c; font-weight:600;">
                        ⚠️ Only {{ product.stock }} items left!
                    </span>
                {% else %}
                    <span style="color:#2ecc71; font-weight:600;">✅ In Stock</span>
                {% endif %}
            </div>

            <!-- Description -->
            <div style="background:#f8f9fa; border-radius:12px; padding:1rem;
                        font-size:0.9rem; color:#555; line-height:1.7;">
                {{ product.description or 'Premium quality product available in multiple sizes and colors.' }}
            </div>

            <!-- Action Buttons -->
            {% if product.stock > 0 %}
            <div style="display:flex; gap:1rem; flex-wrap:wrap; margin-top:0.5rem;">
                <button type="button" onclick="addToCart({{ product.id }})"
                        class="btn-cart"
                        style="flex:1; padding:1rem; font-size:1rem; border-radius:12px;">
                    <i class="fas fa-cart-plus"></i> Add to Cart
                </button>
                <form action="{{ url_for('buy_now', product_id=product.id) }}"
                      method="POST" style="flex:1;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn-buy"
                            style="width:100%; padding:1rem; font-size:1rem; border-radius:12px;">
                        <i class="fas fa-bolt"></i> Buy Now
                    </button>
                </form>
            </div>
            <button type="button" onclick="toggleFavorite({{ product.id }}, this)"
                    style="padding:0.75rem 1.5rem; background:#fee; color:#e74c3c;
                           border:1.5px solid #f5c6cb; border-radius:12px;
                           font-weight:600; cursor:pointer; font-size:0.9rem; width:100%;">
                <i class="fas fa-heart"></i> Add to Favourites
            </button>
            {% endif %}

            <!-- Security note -->
            <div style="display:flex; align-items:center; gap:0.5rem;
                        font-size:0.82rem; color:#999; margin-top:0.5rem;">
                <i class="fas fa-lock" style="color:#6c63ff;"></i>
                Secure checkout | Free return within 7 days
            </div>
        </div>
    </div>

    <!-- Related Products -->
    {% if related %}
    <div>
        <h2 style="font-size:1.4rem; font-weight:800; color:#1a1a2e; margin-bottom:1.5rem;">
            Related Products
        </h2>
        <div class="products-grid">
            {% for p in related %}
            <div class="product-card" data-id="{{ p.id }}">
                <button class="fav-btn" type="button"
                        onclick="toggleFavorite({{ p.id }}, this)">
                    <i class="fas fa-heart"></i>
                </button>
                <a href="{{ url_for('product_detail', product_id=p.id) }}">
                    <div class="card-image">
                        <img src="{{ p.image_url }}" alt="{{ p.name }}" loading="lazy"
                             onerror="this.src='https://via.placeholder.com/300x200'">
                    </div>
                </a>
                <div class="card-info">
                    <span class="card-category">{{ p.category }}</span>
                    <h3 class="card-name">{{ p.name }}</h3>
                    <div class="card-price">
                        <span class="price-current">₹{{ "%.0f"|format(p.price) }}</span>
                        {% if p.original_price and p.original_price > p.price %}
                        <span class="price-original">₹{{ "%.0f"|format(p.original_price) }}</span>
                        {% endif %}
                    </div>
                    <div class="card-actions">
                        <button class="btn-cart" type="button"
                                onclick="addToCart({{ p.id }})">
                            <i class="fas fa-cart-plus"></i> Cart
                        </button>
                        <form action="{{ url_for('buy_now', product_id=p.id) }}"
                              method="POST" style="flex:1;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn-buy">
                                <i class="fas fa-bolt"></i> Buy
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</div>

<script src="{{ url_for('static', filename='js/cart.js') }}"></script>
{% endblock %}